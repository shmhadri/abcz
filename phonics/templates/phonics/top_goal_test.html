{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Top Goal 6 - Unit 1 | Test</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Outfit', sans-serif; background: #f8fafc; margin: 0; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 40px; border-radius: 20px; }
        h1 { color: #7209b7; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <h1>âœ… Top Goal 6 - Unit 1 Works!</h1>
        <p style="text-align: center; font-size: 1.2rem;">Ø§Ù„ØµÙØ­Ø© ØªØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­!</p>
        
        <div style="background: #f0f9ff; padding: 20px; border-radius: 10px; margin-top: 30px;">
            <h3>Debug Info:</h3>
            <p>Vocab count: {{ vocab|length }}</p>
            <p>Sentences count: {{ sentences|length }}</p>
            <p>Quiz JSON length: {{ quizzes_json|length }}</p>
        </div>

        <div style="text-align: center; margin-top: 20px;">
            <button onclick="speak('Audio test complete. British accent active.')" style="padding: 10px 20px; font-size: 1.2rem; cursor: pointer; background: #10b981; color: white; border: none; border-radius: 8px;">
                ğŸ”Š Test Audio
            </button>
        </div>

        <script>
            // Audio Context & Fallbacks
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    
            let voices = [];
            const loadVoices = () => {
                voices = window.speechSynthesis.getVoices();
            };
            window.speechSynthesis.onvoiceschanged = loadVoices;
            loadVoices(); // Initial load
    
            window.speak = function(text, rate = 1) {
                if (!window.speechSynthesis) {
                    console.error("Browser does not support TTS.");
                    return;
                }
                
                // Cancel previous
                window.speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-GB'; // British English
                utterance.volume = 1.0; 
                
                // Attempt to find a British English voice
                if (voices.length === 0) voices = window.speechSynthesis.getVoices();
                const britishVoice = voices.find(v => v.lang === 'en-GB') || 
                                     voices.find(v => v.lang.startsWith('en-') && v.name.includes('UK')) ||
                                     voices.find(v => v.lang.startsWith('en-') && v.name.includes('British')) ||
                                     voices.find(v => v.lang.startsWith('en'));
                if (britishVoice) {
                    utterance.voice = britishVoice;
                }
                
                // Use optimized rate (0.95 default)
                utterance.rate = rate === 1 ? 0.95 : rate;
                
                window.speechSynthesis.speak(utterance);
            };
        </script>
        
        <div style="margin-top: 30px; text-align: center;">
            <a href="{% url 'index' %}" style="background: #7209b7; color: white; padding: 15px 30px; border-radius: 10px; text-decoration: none; display: inline-block;">
                ğŸ  Back to Home
            </a>
        </div>
    </div>
</body>
</html>
